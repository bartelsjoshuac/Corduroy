<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Corduroy/title</title>
        {% load static %}    
        <link rel="stylesheet" href="{% static 'corduroyserver/styles.css' %}">
     
  
    </head>
 <body>
<p> Welcome to Corduroy - Reports Admin

    <table style="border-collapse: collapse; width: 100%; height: 72px;" border="1">

        <tr>
            <td><strong>ID</strong>
            <td><strong>Approved</strong></td>
            <td><strong>Date</strong</td>
            <td><strong>Trail Name</strong</td>
            <td><strong>Groomer</strong></td>
            <td><b><strong>Report</strong></td>
        </tr>     
        
   <!-- I was able to format the form myself, it was working from POSTMAN, but I spent HOURS getting it to PUT like it did in POSTMAN so I asked chat GPT.  I would have 
    never figured out how to make the form do this on my own.-->     
        {% for report in reports %}
        <tr>
            <form id="updateForm_{{ report.id }}">
                <td>{{ report.id }}</td>
                <td>
                    <input type="checkbox" name="approvalStatus" id="approvalStatus_{{ report.id }}" value="True" {% if report.approvalStatus == True %} checked {% endif %}>
                    <label for="approvalStatus_{{ report.id }}">Approved</label>
                </td>
                <td>{{ report.date }}</td>
                <td>{{ report.trailName }}</td>
                <td>{{ report.groomer }}</td>
                <td>
                    <input type="text" name="report" id="report_{{ report.id }}" value="{{ report.report }}">
                </td>
                <td>
                    <input type="hidden" name="reportId" value="{{ report.id }}">
                    <button type="submit">Submit</button>
                </td>
            </form>
        </tr>
    {% endfor %}
    <script>
document.addEventListener("DOMContentLoaded", function() {
 
    const forms = document.querySelectorAll('form[id^="updateForm_"]');

    forms.forEach(form => {
        form.addEventListener("submit", async function(event) {
            event.preventDefault();  

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            data.approvalStatus = formData.get('approvalStatus') ? 1 : 0; 

            const reportId = data.reportId;  
            const url = `http://localhost:8000/reportsadmin/${reportId}/`;
            console.log("Sending PUT request to:", url);

    
            try {
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'  
                    },
                    body: JSON.stringify(data)  
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log("Update successful:", result);
                } else {
                    const errorResponse = await response.json();
                    console.error("Update failed:", response.statusText, errorResponse);
                }
            } catch (error) {
                console.error("An error occurred:", error);
            }
        });
    });
});



    </script>
    
    </table>

         <!--To get the form in JSON like it works in Postman, but this does not work like Postman except it doesn't load the template and it doesn't save the 
         data and has very strange behavior as sometimes it GETS, sometimes it post, sometimes it even has //.  But works in postman 
         I really dunno anymore--> 
     

     <p> NOTE: Submit button gives no feedback yet, but works</p>   

               
        
<p><a href="http://localhost:8000">Home</a>&nbsp<a href="http://localhost:8000/groomers.html">Groomer Admin</a> &nbsp;<a href="http://localhost:8000/reportsadmin/">Reports Admin</a> &nbsp;<a href="http://localhost:8000/trailsadmin.html">Trails Admin</a> &nbsp;</p>