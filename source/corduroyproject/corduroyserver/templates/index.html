 <!-- 
This file contains comments on the general use of Alpine that are not included in subsequent templates
If in doubt about how something works in another template, refer to comments here for similar code
 -->
 

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Corduroy Home</title>
    {% load static %}
    <!-- This is is browser favorite icon and needed in each template to prevent 404's -->
    <link rel="icon" href="{% static 'corduroyserver/favicon.ico' %}" type="image/x-icon">
    <!-- The same stylesheet used in all templates -->
    <link rel="stylesheet" href="{% static 'corduroyserver/styles.css' %}">
    <!--This is the include for Alpine and needed in each template that makes use of Alpine -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.0/dist/cdn.min.js" defer></script>
</head>
<body>
    <header>
        <h1>Welcome to Corduroy</h1>
        <h3>Home of Colorado Snowmobile Trail Grooming Reports</h3>
    </header>

    <div class="container" x-data="{ reports: [], loading: true }" x-init="
        fetch('/approved-reports/')
            .then(response => response.json())
            .then(data => { reports = data; loading = false; });
    ">
        <h1>Current Reports</h1>
        <!-- Message display while Alpine loads data into the table.  This happens to be the reports where approvalStatus==True-->
        <p class="loading-message" x-show="loading">Loading reports...</p>
        <table x-show="!loading && reports.length > 0">
            <thead>
                <tr>
                    <th>Trail Name</th>
                    <th>Location</th>
                    <th>Groomer</th>
                    <th>Date</th>
                    <th>Report</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="report in reports" :key="report.id">
                    <tr>
                        <!-- Alpine uses this field format -->
                        <td x-text="report.trail_name"></td>
                        <td x-text="report.location"></td>
                        <td x-text="report.groomer"></td>
                        <td x-text="new Date(report.date).toLocaleDateString()"></td>
                        <td x-text="report.report"></td>
                    </tr>
                </template>
            </tbody>
        </table>
        <!-- I fixed this through loading one approved report in the sample data, but this handles the situation where there is no approved reports -->
        <p class="empty-message" x-show="!loading && reports.length === 0">No approved reports available.</p>
    </div>

    <footer>
        <br>
        <p>Admin Functions:</p>
        <a href="{% url 'groomer_report_page' %}">Enter Report (Groomers)</a> &nbsp;
        <a href="{% url 'admin_trails' %}">Manage Trails (Admins)</a> &nbsp;
        <a href="{% url 'admin_approval' %}">Approve Pending Reports (Admins)</a>

        {% if user.is_authenticated %}
        <p>Logged in as: {{ user.username }}</p>
        <form action="{% url 'logout' %}" method="post" x-data>
            {% csrf_token %}
            <button 
                type="submit" 
                class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white font-semibold rounded shadow-lg transition duration-300"
                @mouseover="$el.classList.add('ring', 'ring-red-300')"
                @mouseout="$el.classList.remove('ring', 'ring-red-300')"
            >
                Logout
            </button>
        </form>
        {% endif %}
    </footer>
    <!--
    <img src="{% static 'corduroyserver/sled.png' %}" alt="Blue sled" class="homepage-image">
-->

<!--
This is my attempt at some throwback HTML, circa 1997, AKA an animated "Under Construction" GIF of a little man with a saw and a sign.  I guess 25 years later we call these GIPHY's or something.  As it turns out Alpine lets you
animate any image without storing a bunch of GIFs in GIF, you can just tell it to move the GIF.

Yes, it is distracting as ever and only meets the authentically pleasing requirement if it were still 1997.

The sled will stop if you click on it, but since I don't provide that information likely most people will have to live with the sled moving all the time which is well, distracting at best.

With the <blink> tag depreciated, it was the best I could do

I wanted to use this as my status bar in a smaller form with a message or Adding Report, etc.....  But it turned out to be easier, and look nicer to just use a message.
-->
<div x-data="{ position: 0, running: true, interval: null }" x-init="
    interval = setInterval(() => { 
        if (running) position = (position + 1) % window.innerWidth; 
    }, 50)
" style="overflow: hidden; position: relative; width: 100vw; height: 200px;">
    <img 
        src="{% static 'corduroyserver/sled.png' %}" 
        alt="Running Sled"
        x-bind:style="{ transform: `translateX(${position}px)` }"
        @click="running = !running"
        style="position: absolute; top: 50px; height: 100px; cursor: pointer;"
    />
</div>

</body>
</html>
