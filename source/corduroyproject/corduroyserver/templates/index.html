 <!-- 
This file contains comments on the general use of Alpine that are not included in subsequent templates
If in doubt about how something works in another template, refer to comments here for similar code
 -->
 

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Corduroy Home</title>
    {% load static %}
    <!-- This is is browser favorite icon and needed in each template to prevent 404's -->
    <link rel="icon" href="{% static 'corduroyserver/favicon.ico' %}" type="image/x-icon">
    <!-- The same stylesheet used in all templates -->
    <link rel="stylesheet" href="{% static 'corduroyserver/styles.css' %}">
    <!--This is the include for Alpine and needed in each template that makes use of Alpine -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.0/dist/cdn.min.js" defer></script>
</head>
<body>
    <header>
        <h1>Welcome to Corduroy</h1>
        <h3>Home of Colorado Snowmobile Trail Grooming Reports</h3>
    </header>

    <div class="container" x-data="{ reports: [], loading: true }" x-init="
        fetch('/approved-reports/')
            .then(response => response.json())
            .then(data => { reports = data; loading = false; });
    ">
        <h1>Current Reports</h1>
        <!-- Message display while Alpine loads data into the table.  This happens to be the reports where approvalStatus==True-->
        <p class="loading-message" x-show="loading">Loading reports...</p>
        <table x-show="!loading && reports.length > 0">
            <thead>
                <tr>
                    <th>Trail Name</th>
                    <th>Location</th>
                    <th>Groomer</th>
                    <th>Date</th>
                    <th>Report</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="report in reports" :key="report.id">
                    <tr>
                        <!-- Alpine uses this field format -->
                        <td x-text="report.trail_name"></td>
                        <td x-text="report.location"></td>
                        <td x-text="report.groomer"></td>
                        <td x-text="new Date(report.date).toLocaleDateString()"></td>
                        <td x-text="report.report"></td>
                    </tr>
                </template>
            </tbody>
        </table>
        <!-- I fixed this through loading one approved report in the sample data, but this handles the situation where there is no approved reports -->
        <p class="empty-message" x-show="!loading && reports.length === 0">No approved reports available.</p>
    </div>

    <footer>
        <br>
        <p>Admin Functions:</p>
        <a href="{% url 'groomer_report_page' %}">Enter Report (Groomers)</a> &nbsp;
        <a href="{% url 'admin_trails' %}">Manage Trails (Admins)</a> &nbsp;
        <a href="{% url 'admin_approval' %}">Approve Pending Reports (Admins)</a>

        {% if user.is_authenticated %}
        <p>Logged in as: {{ user.username }}</p>
        <form action="{% url 'logout' %}" method="post">
            <!-- Needed in very form, and easy to miss-->
            {% csrf_token %}
            <button type="submit">Logout</button>
        </form>
        {% endif %}
    </footer>
    <img src="{% static 'corduroyserver/sled.png' %}" alt="Blue sled" class="homepage-image">
</body>
</html>
