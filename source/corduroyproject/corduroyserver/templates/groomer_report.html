<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Groomer Admin</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'corduroyserver/styles.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.0/dist/cdn.min.js" defer></script>
</head>
<body>
    <div class="container">
        <h1>Groomer Admin</h1>

        {% if form.errors %}
            <p class="error">Please correct the errors below:</p>
        {% endif %}

        <form method="post" x-data="groomerForm()" x-init="initializeTrails()">
            {% csrf_token %}
            <table>
                <tr>
                    <td><label for="location">Location:</label></td>
                    <td>
                        <select id="location" name="location" x-model="selectedLocation" @change="updateTrails()">
                            <option value="">Select Location</option>
                            <template x-for="(trails, location) in trailsByLocation" :key="location">
                                <option :value="location" x-text="location"></option>
                            </template>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td><label for="id_trail">Trail Name:</label></td>
                    <td>
                        <select id="id_trail" name="trail" x-model="selectedTrail">
                            <option value="">Select Trail</option>
                            <template x-for="trail in filteredTrails" :key="trail.id">
                                <option :value="trail.id" x-text="trail.name"></option>
                            </template>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td><label for="id_report">Report:</label></td>
                    <td>{{ form.report }}</td>
                </tr>
                <tr>
                    <td colspan="2">
                        <button type="submit">Submit Report</button>
                    </td>
                </tr>
            </table>
        </form>

        <p><a href="{% url 'homepage' %}">Back to Home</a></p>
    </div>

    <script>
        function groomerForm() {
            return {
                trailsByLocation: {}, // Loaded from the backend
                selectedLocation: '', // Currently selected location
                selectedTrail: '', // Currently selected trail
                filteredTrails: [], // Trails for the selected location

                initializeTrails() {
                    // Populate trailsByLocation from the Django context
                    this.trailsByLocation = {
                        {% for location, trails in trails_by_location.items %}
                            "{{ location }}": [
                                {% for trail in trails %}
                                    { id: "{{ trail.id }}", name: "{{ trail.name }}" },
                                {% endfor %}
                            ],
                        {% endfor %}
                    };
                },

                updateTrails() {
                    // Update the trails based on the selected location
                    this.filteredTrails = this.trailsByLocation[this.selectedLocation] || [];
                    this.selectedTrail = ''; // Reset the selected trail
                },
            };
        }
    </script>
</body>
</html>
