<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Groomers Admin</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'corduroyserver/styles.css' %}">
</head>
<body>
    <div class="container">
        <h1>Groomer Admin</h1>
        
        {% if form.errors %}
            <p class="error">Please correct the errors below:</p>
        {% endif %}
        
        <form method="post">
            {% csrf_token %}
            <table>
                <tr>
                    <!-- Location will not appear unless there is at least one trail defined in that location.
                     I am not sure the best practive to handle exceptions for required default data, shipp with sample data, or 
                     handle exception in the code.  
                      -->
                    <td><label for="location">Location:</label></td>
                    <td>
                        <select id="location" name="location" onchange="updateTrails()">
                            <option value="">Select Location</option>
                            {% for location in trails_by_location.keys %}
                                <option value="{{ location }}">{{ location }}</option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td><label for="id_trail">Trail Name:</label></td>
                    <td>
                        <select id="id_trail" name="trail">
                            <option value="">Select Trail</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td><label for="id_report">Report:</label></td>
                    <!--Django doc says it can handle escaping input for XSS for me automatically 
                    Is escaping needed for none text inputs????
                    -->
                    <td>{{ form.report|escape  }}</td>
                </tr>
                <tr>
                    <td colspan="2">
                        <button type="submit">Submit Report</button>
                    </td>
                </tr>
                <!-- Removed the groomerID and the date as hidden fields to be taken from the request and handled by the view, but does that mean someone could still POST those attribute
                value pairs since the view handles them, so this is an area where I am not sure how secure this is. 
                -->
            </table>
        </form>
        <p><a href="{% url 'homepage' %}">Back to Home</a></p>
    </div>

    <!--Need security added-->
    <script>
        const trailsByLocation = {{ trails_by_location|safe }};
        function updateTrails() {
            const location = document.getElementById('location').value;
            const trailSelect = document.getElementById('id_trail');s
            trailSelect.innerHTML = '<option value="">Select Trail</option>';
            if (trailsByLocation[location]) {
                trailsByLocation[location].forEach(trail => {
                    const option = document.createElement('option');
                    option.value = trail.id;
                    option.textContent = trail.name;
                    trailSelect.appendChild(option);
                });
            }
        }
    </script>
</body>
</html>

